<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUIVI DLC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            padding: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            margin: 15px 0;
            color: #1a237e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }

        .user-inputs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .user-input-group {
            flex: 1;
        }

        input, select, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border: 2px solid #1a237e;
            font-size: 14px;
        }

        button {
            background: #1a237e;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        button:hover {
            background: #0d1459;
            transform: translateY(-2px);
        }

        #scanButton, #casseFraisScanButton {
            background: #e67e22;
        }

        #scanButton:hover, #casseFraisScanButton:hover {
            background: #d35400;
        }

        #addButton, #casseFraisAddButton {
            background: #2ecc71;
        }

        #addButton:hover, #casseFraisAddButton:hover {
            background: #27ae60;
        }

        #importButton {
            background: #9b59b6;
        }

        #importButton:hover {
            background: #8e44ad;
        }

        #downloadXLSX, #casseFraisDownloadXLSX {
            background: #3498db;
        }

        #downloadXLSX:hover, #casseFraisDownloadXLSX:hover {
            background: #2980b9;
        }

        #shareButton, #casseFraisShareButton {
            background: #f1c40f;
            color: #333;
        }

        #shareButton:hover, #casseFraisShareButton:hover {
            background: #f39c12;
        }

        #searchButton, #casseFraisButton {
            background: #1abc9c;
        }

        #searchButton:hover, #casseFraisButton:hover {
            background: #16a085;
        }

        #casseFraisButton {
            background: #e74c3c;
        }

        #casseFraisButton:hover {
            background: #c0392b;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .button-row {
            display: flex;
            gap: 8px;
        }

        .button-row button {
            flex: 1;
        }

        .code-scan-container {
            display: flex;
            gap: 8px;
        }

        .date-quantity-container {
            display: flex;
            gap: 8px;
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }

        .camera-icon, .stock-icon {
            background: #3498db;
            font-size: 16px;
            padding: 6px;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #previewImage {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        #productCount, #casseFraisProductCount {
            text-align: center;
            background: #1a237e;
            color: #ffeb3b;
            padding: 8px 16px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: bold;
        }

        .month-count {
            background: #ffeb3b;
            color: #e74c3c;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 8px;
        }

        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 12px;
            align-items: flex-start;
            position: relative;
            animation: fadeIn 0.35s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-image-container {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1a237e;
            border-radius: 10px;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }

        .card-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .days-left {
            padding: 6px 10px;
            border-radius: 8px;
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }

        .card-code {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 4px;
            padding: 4px 8px;
            background: #ecf0f1;
            border-radius: 6px;
            display: inline-block;
        }

        .card-name {
            font-size: 16px;
            font-weight: 700;
            color: #000000;
            line-height: 1.3;
            min-height: 2.8em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-details {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #2c3e50;
            margin-top: 4px;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .card-date, .card-quantity {
            cursor: pointer;
        }

        .card-date {
            font-weight: 600;
            color: #e74c3c;
        }

        .card-quantity {
            font-weight: 600;
            color: #27ae60;
        }

        .card-footer {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 5px;
        }

        .card-footer button {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 16px;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .delete-btn {
            background: #e74c3c;
        }

        .edit-btn {
            background: #3498db;
        }

        .month-section {
            margin: 8px 0 3px 0;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            text-align: center;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expired-section {
            background: #e74c3c;
        }

        .future-section {
            background: #1a237e;
        }

        .section-delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            white-space: nowrap;
            width: 120px;
        }

        .section-delete-btn:hover {
            background: #c0392b;
        }

        .page-container {
            display: flex;
            flex-direction: column;
        }

        .search-page, .casse-frais-page {
            display: none;
        }

        .storage-info {
            background: #3498db;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin: 5px 0 15px 0;
            text-align: center;
        }

        .success-message {
            background: #2ecc71;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }

        .custom-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10001;
            justify-content: center;
            align-items: center;
        }

        .confirm-dialog {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .confirm-title {
            font-size: 20px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .confirm-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            min-width: 120px;
            text-transform: uppercase;
        }

        .confirm-cancel {
            background: #95a5a6;
            color: white;
        }

        .confirm-ok {
            background: #3498db;
            color: white;
        }

        .alert-ok {
            background: #2ecc71;
            color: white;
        }

        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #1a237e;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
        }

        #cameraOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #cameraOverlay video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 10000;
        }

        #captureButton, #closeCameraButton {
            width: 140px;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        #captureButton {
            background: #2ecc71;
        }

        #closeCameraButton {
            background: #e74c3c;
        }

        .scanner-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .scanner-frame {
            width: 90%;
            max-width: 400px;
            height: 300px;
            border: 2px solid #fff;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .scanner-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .scanner-controls button {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        #closeScanner, #casseFraisCloseScanner {
            background: #e74c3c;
        }

        #toggleTorch, #casseFraisToggleTorch {
            background: #3498db;
        }

        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .search-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .search-input-group label {
            font-weight: bold;
            color: #1a237e;
            text-transform: uppercase;
            font-size: 14px;
        }

        .search-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .search-buttons button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        #searchBackButton {
            background: #95a5a6;
        }

        #performSearchButton {
            background: #3498db;
        }

        .search-results-title {
            background: #795548;
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            text-transform: uppercase;
            display: none;
        }

        .pdf-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            display: none;
        }

        .pdf-buttons button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            font-weight: bold;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #downloadPDF {
            background: #2e7d32;
        }

        #sharePDF {
            background: #8e44ad;
        }

        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .edit-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .edit-input-group {
            margin-bottom: 15px;
        }

        .edit-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #1a237e;
        }

        .edit-input-group input {
            width: 100%;
            padding: 8px;
            border: 2px solid #1a237e;
            border-radius: 6px;
        }

        .edit-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .edit-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        #saveEditButton {
            background: #2ecc71;
            color: white;
        }

        #cancelEditButton {
            background: #95a5a6;
            color: white;
        }

        @media (max-width: 480px) {
            .user-inputs-container {
                flex-direction: column;
            }
            
            .card {
                flex-direction: column;
                text-align: center;
            }
            
            .card-image-container {
                align-self: center;
            }
            
            .card-footer {
                position: relative;
                justify-content: center;
                margin-top: 10px;
            }
            
            .date-quantity-container {
                flex-direction: column;
            }
            
            .code-scan-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
    <div id="mainPage" class="page-container">
        <div class="storage-info" id="storageInfo">
            üíæ Chargement des donn√©es...
        </div>
        
        <h2>SUIVI DLC</h2>

        <div class="user-inputs-container">
            <div class="user-input-group">
                <input type="text" id="userNameInput" placeholder="NOM D'EMPLOY√â">
            </div>
            <div class="user-input-group">
                <select id="rayonSelect">
                    <option value="">RAYON</option>
                    <option value="LIQUIDE">LIQUIDE</option>
                    <option value="EPICERIE">EPICERIE</option>
                    <option value="BISCUITERIE">BISCUITERIE</option>
                    <option value="ENTRETIEN">ENTRETIEN</option>
                    <option value="BEAUTE-SANTE">BEAUTE-SANTE</option>
                    <option value="STAND TRAITEUR">STAND TRAITEUR</option>
                    <option value="CHARCUTERIE">CHARCUTERIE</option>
                    <option value="STAND">STAND</option>
                    <option value="CREMERIE">CREMERIE</option>
                    <option value="SURGELE">SURGELE</option>
                    <option value="BOUCHERIE">BOUCHERIE</option>
                    <option value="VOLAILLE">VOLAILLE</option>
                    <option value="BOULANGERIE">BOULANGERIE</option>
                    <option value="PATISSERIE">PATISSERIE</option>
                    <option value="POISSONNERIE">POISSONNERIE</option>
                    <option value="BOULANGERIE PATISSERIE NEGOCE">BOULANGERIE PATISSERIE NEGOCE</option>
                    <option value="FRUIT ET LEGUM">FRUIT ET LEGUM</option>
                    <option value="PRODUITS VRACS">PRODUITS VRACS</option>
                </select>
            </div>
        </div>

        <div class="inputs-container">
            <div class="input-group">
                <div class="code-scan-container">
                    <input id="codeInput" type="number" placeholder="Code produit" maxlength="13">
                    <button id="scanButton">SCANNER</button>
                </div>
                <div id="reader"></div>
            </div>

            <div class="input-group">
                <textarea id="nameOutput" class="product-name-textarea" placeholder="Nom produit" readonly rows="2"></textarea>
            </div>

            <div class="input-group">
                <div class="date-quantity-container">
                    <input id="expiryInput" type="text" placeholder="Date (DD/MM/YY)" maxlength="8" inputmode="numeric">
                    <input id="quantityInput" type="number" placeholder="Quantit√© (Optionnel)" max="9999">
                </div>
            </div>

            <div class="input-group">
                <div class="image-container">
                    <div class="stock-icon" id="stockButton">üñºÔ∏è</div>
                    <img id="previewImage" src="" alt="">
                    <div class="camera-icon" id="cameraButton">üì∑</div>
                </div>
                <input type="file" id="imageInput" accept="image/*" style="display:none;">
            </div>

            <div class="buttons-container">
                <div class="button-row">
                    <button id="addButton">‚ûï AJOUTER</button>
                    <button id="importButton">üì• IMPORTER</button>
                </div>
                <div class="button-row">
                    <button id="downloadXLSX">üìä TELECHARGER</button>
                    <button id="shareButton">üîó PARTAGER</button>
                </div>
                <div class="button-row">
                    <button id="searchButton">üîç RECHERCHE</button>
                    <button id="casseFraisButton">üì¶ CASSE FRAIS</button>
                </div>
            </div>
        </div>

        <div style="height: 15px;"></div>

        <p id="productCount">NOMBRE DES PRODUITS: <span id="productCountNumber" class="month-count">0</span></p>
        <div class="cards-container" id="cardsContainer"></div>
    </div>

    <!-- ÿµŸÅÿ≠ÿ© ÿßŸÑÿ®ÿ≠ÿ´ -->
    <div id="searchPage" class="search-page">
        <h2>RECHERCHE</h2>
        <div class="search-inputs">
            <div class="search-input-group">
                <label for="dateSearch">Recherche par Date (DD/MM/YY)</label>
                <select id="dateSearch">
                    <option value="">S√©lectionnez une date</option>
                </select>
            </div>
            <div class="search-input-group">
                <label for="monthSearch">Recherche par Mois (MM/YYYY)</label>
                <select id="monthSearch">
                    <option value="">S√©lectionnez un mois</option>
                </select>
            </div>
        </div>
        <div class="search-buttons">
            <button id="searchBackButton">‚¨ÖÔ∏è RETOUR</button>
            <button id="performSearchButton">üîç RECHERCHER</button>
        </div>
        <div class="search-results-title" id="searchResultsTitle">
            R√âSULTATS DE RECHERCHE
        </div>
        <div class="cards-container" id="searchResultsContainer"></div>
        <div class="pdf-buttons" id="pdfButtons">
            <button id="downloadPDF">üì• TELECHARGER</button>
            <button id="sharePDF">üîó PARTAGER</button>
        </div>
    </div>

    <!-- ÿµŸÅÿ≠ÿ© CASSE FRAIS -->
    <div id="casseFraisPage" class="casse-frais-page">
        <h2>CASSE FRAIS</h2>

        <div class="inputs-container">
            <div class="input-group">
                <div class="code-scan-container">
                    <input id="casseFraisCodeInput" type="number" placeholder="Code produit" maxlength="13">
                    <button id="casseFraisScanButton">SCANNER</button>
                </div>
                <div id="casseFraisReader"></div>
            </div>

            <div class="input-group">
                <textarea id="casseFraisNameOutput" class="product-name-textarea" placeholder="Nom produit" readonly rows="2"></textarea>
            </div>

            <div class="input-group">
                <div class="date-quantity-container">
                    <input id="casseFraisExpiryInput" type="text" placeholder="Date (DD/MM/YY)" maxlength="8" inputmode="numeric">
                    <input id="casseFraisQuantityInput" type="number" placeholder="Quantit√© (Optionnel)" max="9999">
                </div>
            </div>

            <div class="buttons-container">
                <div class="button-row">
                    <button id="casseFraisAddButton">‚ûï AJOUTER</button>
                </div>
                <div class="button-row">
                    <button id="casseFraisDownloadXLSX">üìä TELECHARGER</button>
                    <button id="casseFraisShareButton">üîó PARTAGER</button>
                </div>
            </div>
        </div>

        <button id="casseFraisBackButton" style="width:100%; margin:15px 0; background:#95a5a6;">‚¨ÖÔ∏è RETOUR</button>

        <p id="casseFraisProductCount">NOMBRE DES PRODUITS: <span id="casseFraisProductCountNumber" class="month-count">0</span></p>
        <div class="cards-container" id="casseFraisCardsContainer"></div>
    </div>

    <!-- ŸÜŸàÿßŸÅÿ∞ ÿ•ÿ∂ÿßŸÅŸäÿ© -->
    <div id="cameraOverlay">
        <video id="cameraVideo" autoplay></video>
        <div class="camera-controls">
            <button id="captureButton">üì∏ CAPTURER</button>
            <button id="closeCameraButton">‚ùå FERMER</button>
        </div>
    </div>

    <div id="scannerOverlay" class="scanner-overlay">
        <div class="scanner-frame" id="scannerFrame"></div>
        <div class="scanner-controls">
            <button id="toggleTorch">üí° FLASH</button>
            <button id="closeScanner">‚ùå FERMER</button>
        </div>
        <div class="loading-spinner" id="scannerLoading"></div>
    </div>

    <div id="casseFraisScannerOverlay" class="scanner-overlay">
        <div class="scanner-frame" id="casseFraisScannerFrame"></div>
        <div class="scanner-controls">
            <button id="casseFraisToggleTorch">üí° FLASH</button>
            <button id="casseFraisCloseScanner">‚ùå FERMER</button>
        </div>
        <div class="loading-spinner" id="casseFraisScannerLoading"></div>
    </div>

    <div id="editModal" class="edit-modal">
        <div class="edit-content">
            <h3>Modifier le produit</h3>
            <div class="edit-input-group">
                <label for="editExpiry">Date (DD/MM/YY)</label>
                <input type="text" id="editExpiry" placeholder="Date (DD/MM/YY)" maxlength="8">
            </div>
            <div class="edit-input-group">
                <label for="editQuantity">Quantit√©</label>
                <input type="number" id="editQuantity" placeholder="Quantit√©" max="9999">
            </div>
            <div class="edit-input-group">
                <label for="editImage">Image</label>
                <input type="file" id="editImage" accept="image/*">
            </div>
            <div class="edit-buttons">
                <button id="saveEditButton">üíæ SAUVEGARDER</button>
                <button id="cancelEditButton">‚ùå ANNULER</button>
            </div>
        </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ≠Ÿàÿßÿ± ÿßŸÑŸÖÿÆÿµÿµÿ© -->
    <div id="customConfirmModal" class="custom-confirm-modal">
        <div class="confirm-dialog">
            <h3 class="confirm-title" id="confirmTitle">Confirmation</h3>
            <p class="confirm-message" id="confirmMessage">Message</p>
            <div class="confirm-buttons">
                <button id="confirmCancelBtn" class="confirm-btn confirm-cancel">ANNULER</button>
                <button id="confirmOkBtn" class="confirm-btn confirm-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ -->
    <button class="scroll-to-top" id="scrollToTopMain">‚Üë</button>
    <button class="scroll-to-top" id="scrollToTopSearch">‚Üë</button>
    <button class="scroll-to-top" id="scrollToTopCasseFrais">‚Üë</button>

    <!-- ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠ -->
    <div class="success-message" id="successMessage"></div>

    <script>
        // ==== ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸàÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿπÿßŸÖÿ© ====
        let database = [];
        let products = [];
        let casseFraisProducts = [];
        let selectedImageFile = null;
        let flashEnabled = false;
        let currentStream = null;
        let html5QrCode;
        let casseFraisHtml5QrCode;
        let db = null;
        let searchResults = [];
        let currentEditingProduct = null;
        let productImages = {};

        // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ====
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
        });

        // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ====
        async function initApp() {
            try {
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
                const savedProducts = localStorage.getItem('products');
                if (savedProducts) {
                    products = JSON.parse(savedProducts);
                }
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜÿ™ÿ¨ÿßÿ™ CASSE FRAIS ŸÖŸÜ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
                const savedCasseFrais = localStorage.getItem('casseFraisProducts');
                if (savedCasseFrais) {
                    casseFraisProducts = JSON.parse(savedCasseFrais);
                }
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                loadUserData();
                
                // ÿπÿ±ÿ∂ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™
                renderCards();
                renderCasseFraisCards();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ
                updateStorageInfo();
                
                // ÿ•ÿπÿØÿßÿØ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ
                setupScrollToTop();
                
                // ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                loadDatabase();
                
            } catch (error) {
                console.error('Error initializing app:', error);
                document.getElementById('storageInfo').innerHTML = 
                    '‚ö†Ô∏è Mode hors ligne - Donn√©es locales uniquement';
            }
        }

        // ==== ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ====
        function setupEventListeners() {
            // ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
            document.getElementById('addButton').addEventListener('click', addProductHandler);
            document.getElementById('scanButton').addEventListener('click', startScanner);
            document.getElementById('importButton').addEventListener('click', importHandler);
            document.getElementById('downloadXLSX').addEventListener('click', downloadXLSXDirect);
            document.getElementById('shareButton').addEventListener('click', shareXLSXDirect);
            document.getElementById('searchButton').addEventListener('click', showSearchPage);
            document.getElementById('casseFraisButton').addEventListener('click', showCasseFraisPage);
            
            // ÿµŸÅÿ≠ÿ© ÿßŸÑÿ®ÿ≠ÿ´
            document.getElementById('searchBackButton').addEventListener('click', showMainPage);
            document.getElementById('performSearchButton').addEventListener('click', performSearch);
            document.getElementById('downloadPDF').addEventListener('click', downloadPDF);
            document.getElementById('sharePDF').addEventListener('click', sharePDF);
            
            // ÿµŸÅÿ≠ÿ© CASSE FRAIS
            document.getElementById('casseFraisBackButton').addEventListener('click', showMainPage);
            document.getElementById('casseFraisAddButton').addEventListener('click', addCasseFraisProductHandler);
            document.getElementById('casseFraisScanButton').addEventListener('click', startCasseFraisScanner);
            document.getElementById('casseFraisDownloadXLSX').addEventListener('click', downloadCasseFraisXLSXDirect);
            document.getElementById('casseFraisShareButton').addEventListener('click', shareCasseFraisXLSXDirect);
            
            // ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß
            document.getElementById('cameraButton').addEventListener('click', openCamera);
            document.getElementById('closeCameraButton').addEventListener('click', closeCamera);
            document.getElementById('captureButton').addEventListener('click', captureImage);
            document.getElementById('stockButton').addEventListener('click', openImagePicker);
            document.getElementById('imageInput').addEventListener('change', handleImageSelection);
            
            // ÿßŸÑŸÖÿßÿ≥ÿ≠ ÿßŸÑÿ∂Ÿàÿ¶Ÿä
            document.getElementById('closeScanner').addEventListener('click', stopScanner);
            document.getElementById('toggleTorch').addEventListener('click', toggleTorch);
            document.getElementById('casseFraisCloseScanner').addEventListener('click', stopCasseFraisScanner);
            document.getElementById('casseFraisToggleTorch').addEventListener('click', toggleCasseFraisTorch);
            
            // ÿßŸÑÿ™ÿπÿØŸäŸÑ
            document.getElementById('saveEditButton').addEventListener('click', saveEdit);
            document.getElementById('cancelEditButton').addEventListener('click', cancelEdit);
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ÿπŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨
            document.getElementById('codeInput').addEventListener('input', searchProduct);
            document.getElementById('casseFraisCodeInput').addEventListener('input', searchCasseFraisProduct);
            
            // ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            document.getElementById('expiryInput').addEventListener('input', formatDate);
            document.getElementById('casseFraisExpiryInput').addEventListener('input', formatDate);
            document.getElementById('editExpiry').addEventListener('input', formatDate);
            
            // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            document.getElementById('userNameInput').addEventListener('input', saveUserData);
            document.getElementById('rayonSelect').addEventListener('change', saveUserData);
            
            // ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ≠Ÿàÿßÿ±
            document.getElementById('confirmCancelBtn').addEventListener('click', closeConfirmModal);
            document.getElementById('confirmOkBtn').addEventListener('click', confirmAction);
        }

        // ==== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ====
        function showMainPage() {
            document.getElementById('mainPage').style.display = 'flex';
            document.getElementById('searchPage').style.display = 'none';
            document.getElementById('casseFraisPage').style.display = 'none';
            renderCards();
        }

        function showSearchPage() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('searchPage').style.display = 'flex';
            document.getElementById('casseFraisPage').style.display = 'none';
            initializeSearchPage();
        }

        function showCasseFraisPage() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('searchPage').style.display = 'none';
            document.getElementById('casseFraisPage').style.display = 'flex';
            renderCasseFraisCards();
        }

        // ==== ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ====
        function addProductHandler() {
            const code = document.getElementById('codeInput').value.trim();
            const name = document.getElementById('nameOutput').value.trim();
            let expiry = document.getElementById('expiryInput').value.trim();
            const quantity = document.getElementById('quantityInput').value;
            
            expiry = formatDateInput(expiry);
            
            if (!expiry || !isValidDate(expiry)) {
                showCustomAlert("DATE INVALIDE!", "Veuillez saisir une date valide au format DD/MM/AA");
                return;
            }
            
            if (!code) {
                showCustomAlert("CHAMPS MANQUANTS", "Veuillez remplir le code produit!");
                return;
            }
            
            const duplicate = products.find(p => p.code === code && p.expiry === expiry);
            if (duplicate) {
                showCustomAlert("PRODUIT EXISTANT", "Ce produit a d√©j√† √©t√© ajout√©!");
                return;
            }
            
            const product = {
                id: Date.now(),
                code,
                name: name.toUpperCase(),
                expiry,
                quantity: quantity || "",
                img: selectedImageFile ? URL.createObjectURL(selectedImageFile) : null,
                timestamp: new Date().getTime()
            };
            
            products.push(product);
            saveProducts();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('codeInput').value = '';
            document.getElementById('nameOutput').value = '';
            document.getElementById('expiryInput').value = '';
            document.getElementById('quantityInput').value = '';
            document.getElementById('previewImage').src = '';
            selectedImageFile = null;
            
            renderCards();
            showSuccessMessage("Produit ajout√© avec succ√®s!");
        }

        function addCasseFraisProductHandler() {
            const code = document.getElementById('casseFraisCodeInput').value.trim();
            const name = document.getElementById('casseFraisNameOutput').value.trim();
            let expiry = document.getElementById('casseFraisExpiryInput').value.trim();
            const quantity = document.getElementById('casseFraisQuantityInput').value;
            
            expiry = formatDateInput(expiry);
            
            if (!expiry || !isValidDate(expiry)) {
                showCustomAlert("DATE INVALIDE!", "Veuillez saisir une date valide au format DD/MM/AA");
                return;
            }
            
            if (!code) {
                showCustomAlert("CHAMPS MANQUANTS", "Veuillez remplir le code produit!");
                return;
            }
            
            const duplicate = casseFraisProducts.find(p => p.code === code && p.expiry === expiry);
            if (duplicate) {
                showCustomAlert("PRODUIT EXISTANT", "Ce produit a d√©j√† √©t√© ajout√©!");
                return;
            }
            
            const product = {
                id: Date.now(),
                code,
                name: name.toUpperCase(),
                expiry,
                quantity: quantity || "",
                timestamp: new Date().getTime()
            };
            
            casseFraisProducts.push(product);
            saveCasseFraisProducts();
            
            // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ
            document.getElementById('casseFraisCodeInput').value = '';
            document.getElementById('casseFraisNameOutput').value = '';
            document.getElementById('casseFraisExpiryInput').value = '';
            document.getElementById('casseFraisQuantityInput').value = '';
            
            renderCasseFraisCards();
            showSuccessMessage("Produit ajout√© √† Casse Frais avec succ√®s!");
        }

        function deleteProduct(id) {
            showCustomConfirm(1, function() {
                products = products.filter(p => p.id !== id);
                saveProducts();
                renderCards();
                showSuccessMessage("Produit supprim√© avec succ√®s!");
            });
        }

        function deleteCasseFraisProduct(id) {
            showCustomConfirm(1, function() {
                casseFraisProducts = casseFraisProducts.filter(p => p.id !== id);
                saveCasseFraisProducts();
                renderCasseFraisCards();
                showSuccessMessage("Produit supprim√© de Casse Frais avec succ√®s!");
            });
        }

        function deleteAllInSection(sectionProducts) {
            showCustomConfirm(sectionProducts.length, function() {
                products = products.filter(p => !sectionProducts.some(sp => sp.id === p.id));
                saveProducts();
                renderCards();
                showSuccessMessage(`${sectionProducts.length} produits supprim√©s avec succ√®s!`);
            });
        }

        // ==== ÿπÿ±ÿ∂ ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ ====
        function renderCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            if (products.length === 0) {
                container.innerHTML = '<div class="card"><div class="card-content"><div class="card-name">Aucun produit ajout√©</div></div></div>';
                document.getElementById('productCountNumber').textContent = '0';
                return;
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            const sortedProducts = [...products].sort((a, b) => {
                const [d1, m1, y1] = a.expiry.split('/').map(Number);
                const [d2, m2, y2] = b.expiry.split('/').map(Number);
                return new Date(y1, m1-1, d1) - new Date(y2, m2-1, d2);
            });
            
            const expiredProducts = [];
            const futureProducts = [];
            
            sortedProducts.forEach(p => {
                const remaining = daysLeft(p.expiry);
                if (remaining < 0) {
                    expiredProducts.push(p);
                } else {
                    futureProducts.push(p);
                }
            });
            
            // ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖŸÜÿ™ŸáŸäÿ© ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
            if (expiredProducts.length > 0) {
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'month-section expired-section';
                sectionTitle.innerHTML = `
                    <span>P√âRIM√â <span class="month-count">${expiredProducts.length}</span></span>
                    <button class="section-delete-btn" onclick="deleteAllInSection(${JSON.stringify(expiredProducts).replace(/"/g, '&quot;')})">
                        SUPPRIMER
                    </button>
                `;
                container.appendChild(sectionTitle);
                
                expiredProducts.forEach(p => {
                    const remaining = daysLeft(p.expiry);
                    const color = daysColor(remaining);
                    const card = createCard(p, color, true);
                    container.appendChild(card);
                });
            }
            
            // ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±
            const productsByMonth = {};
            
            futureProducts.forEach(p => {
                const [d, m, y] = p.expiry.split('/').map(Number);
                const monthKey = `${m.toString().padStart(2, '0')}-${y}`;
                if (!productsByMonth[monthKey]) {
                    productsByMonth[monthKey] = [];
                }
                productsByMonth[monthKey].push(p);
            });
            
            Object.keys(productsByMonth).sort((a, b) => {
                const [m1, y1] = a.split('-').map(Number);
                const [m2, y2] = b.split('-').map(Number);
                return new Date(y1, m1-1) - new Date(y2, m2-1);
            }).forEach(monthKey => {
                const sectionProducts = productsByMonth[monthKey];
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'month-section future-section';
                sectionTitle.innerHTML = `
                    <span>MOIS ${monthKey} <span class="month-count">${sectionProducts.length}</span></span>
                    <button class="section-delete-btn" onclick="deleteAllInSection(${JSON.stringify(sectionProducts).replace(/"/g, '&quot;')})">
                        SUPPRIMER
                    </button>
                `;
                container.appendChild(sectionTitle);
                
                sectionProducts.forEach(p => {
                    const remaining = daysLeft(p.expiry);
                    const color = daysColor(remaining);
                    const card = createCard(p, color, false);
                    container.appendChild(card);
                });
            });
            
            document.getElementById('productCountNumber').textContent = products.length;
        }

        function renderCasseFraisCards() {
            const container = document.getElementById('casseFraisCardsContainer');
            container.innerHTML = '';
            
            if (casseFraisProducts.length === 0) {
                container.innerHTML = '<div class="card"><div class="card-content"><div class="card-name">Aucun produit dans Casse Frais</div></div></div>';
                document.getElementById('casseFraisProductCountNumber').textContent = '0';
                return;
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            const sortedProducts = [...casseFraisProducts].sort((a, b) => {
                const [d1, m1, y1] = a.expiry.split('/').map(Number);
                const [d2, m2, y2] = b.expiry.split('/').map(Number);
                return new Date(y1, m1-1, d1) - new Date(y2, m2-1, d2);
            });
            
            sortedProducts.forEach(p => {
                const remaining = daysLeft(p.expiry);
                const color = daysColor(remaining);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-content">
                        <div class="card-header">
                            <span class="days-left" style="background:${color}">${remaining} JOURS RESTANT</span>
                        </div>
                        <span class="card-code">${p.code}</span>
                        <div class="card-name">${p.name}</div>
                        <div class="card-details">
                            <span class="card-date">DATE: ${p.expiry}</span>
                            <span class="card-quantity">QUANTIT√â: ${p.quantity}</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="delete-btn" onclick="deleteCasseFraisProduct(${p.id})">X</button>
                    </div>
                `;
                container.appendChild(card);
            });
            
            document.getElementById('casseFraisProductCountNumber').textContent = casseFraisProducts.length;
        }

        function createCard(product, color, isExpired) {
            const remaining = daysLeft(product.expiry);
            const daysText = isExpired ? `- ${Math.abs(remaining)} JOURS` : `${remaining} JOURS RESTANT`;
            
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-image-container" onclick="openEditModal(${product.id})">
                    ${product.img ? `<img src="${product.img}" alt="">` : ''}
                    <div class="edit-overlay">üìù MODIFIER</div>
                </div>
                <div class="card-content">
                    <div class="card-header">
                        <span class="days-left" style="background:${color}">${daysText}</span>
                    </div>
                    <span class="card-code">${product.code}</span>
                    <div class="card-name">${product.name}</div>
                    <div class="card-details">
                        <span class="card-date" onclick="openEditModal(${product.id})">DATE: ${product.expiry}</span>
                        <span class="card-quantity" onclick="openEditModal(${product.id})">QUANTIT√â: ${product.quantity}</span>
                    </div>
                </div>
                <div class="card-footer">
                    <button class="edit-btn" onclick="openEditModal(${product.id})">‚úèÔ∏è</button>
                    <button class="delete-btn" onclick="deleteProduct(${product.id})">X</button>
                </div>
            `;
            return card;
        }

        // ==== ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ====
        function searchProduct() {
            const code = this.value.trim().toLowerCase();
            const product = database.find(item => (item.Code || '').trim().toLowerCase() === code);
            document.getElementById('nameOutput').value = product ? (product.Nom || '').trim().toUpperCase() : '';
        }

        function searchCasseFraisProduct() {
            const code = this.value.trim().toLowerCase();
            const product = database.find(item => (item.Code || '').trim().toLowerCase() === code);
            document.getElementById('casseFraisNameOutput').value = product ? (product.Nom || '').trim().toUpperCase() : '';
        }

        // ==== ÿßŸÑÿ™ÿπÿØŸäŸÑ ====
        function openEditModal(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            currentEditingProduct = product;
            document.getElementById('editExpiry').value = product.expiry;
            document.getElementById('editQuantity').value = product.quantity;
            document.getElementById('editModal').style.display = 'flex';
        }

        function saveEdit() {
            if (!currentEditingProduct) return;
            
            const newExpiry = document.getElementById('editExpiry').value;
            const newQuantity = document.getElementById('editQuantity').value;
            const imageFile = document.getElementById('editImage').files[0];
            
            if (!newExpiry || !isValidDate(formatDateInput(newExpiry))) {
                showCustomAlert("DATE INVALIDE!", "Veuillez saisir une date valide au format DD/MM/AA");
                return;
            }
            
            const productIndex = products.findIndex(p => p.id === currentEditingProduct.id);
            if (productIndex !== -1) {
                products[productIndex].expiry = formatDateInput(newExpiry);
                products[productIndex].quantity = newQuantity || '';
                
                if (imageFile) {
                    products[productIndex].img = URL.createObjectURL(imageFile);
                }
                
                saveProducts();
                renderCards();
                document.getElementById('editModal').style.display = 'none';
                showSuccessMessage("Produit modifi√© avec succ√®s!");
            }
        }

        function cancelEdit() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingProduct = null;
        }

        // ==== ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ŸàÿßŸÑÿµŸàÿ± ====
        function openCamera() {
            const overlay = document.getElementById('cameraOverlay');
            const video = document.getElementById('cameraVideo');
            overlay.style.display = 'flex';

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    currentStream = stream;
                    video.srcObject = stream;
                })
                .catch(err => {
                    console.error('Error accessing camera:', err);
                    showCustomAlert("ERREUR CAM√âRA", "Impossible d'acc√©der √† la cam√©ra");
                    overlay.style.display = 'none';
                });
        }

        function closeCamera() {
            const overlay = document.getElementById('cameraOverlay');
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            overlay.style.display = 'none';
        }

        function captureImage() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            canvas.toBlob(blob => {
                selectedImageFile = new File([blob], 'camera.jpg', { type: 'image/jpeg' });
                document.getElementById('previewImage').src = URL.createObjectURL(selectedImageFile);
                closeCamera();
            }, 'image/jpeg', 0.8);
        }

        function openImagePicker() {
            document.getElementById('imageInput').click();
        }

        function handleImageSelection(e) {
            if (e.target.files.length > 0) {
                selectedImageFile = e.target.files[0];
                document.getElementById('previewImage').src = URL.createObjectURL(selectedImageFile);
            }
        }

        // ==== ÿßŸÑŸÖÿßÿ≥ÿ≠ ÿßŸÑÿ∂Ÿàÿ¶Ÿä ====
        function startScanner() {
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿßÿ≥ÿ≠ ÿßŸÑÿ∂Ÿàÿ¶Ÿä (ÿ®ÿØŸàŸÜ ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©)
            showCustomAlert("SCANNER", "Fonction scanner - Entrez le code manuellement");
        }

        function stopScanner() {
            document.getElementById('scannerOverlay').style.display = 'none';
        }

        function startCasseFraisScanner() {
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿßÿ≥ÿ≠ ÿßŸÑÿ∂Ÿàÿ¶Ÿä (ÿ®ÿØŸàŸÜ ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©)
            showCustomAlert("SCANNER", "Fonction scanner - Entrez le code manuellement");
        }

        function stopCasseFraisScanner() {
            document.getElementById('casseFraisScannerOverlay').style.display = 'none';
        }

        function toggleTorch() {
            flashEnabled = !flashEnabled;
            this.textContent = flashEnabled ? "üí° ON" : "üí° OFF";
        }

        function toggleCasseFraisTorch() {
            flashEnabled = !flashEnabled;
            this.textContent = flashEnabled ? "üí° ON" : "üí° OFF";
        }

        // ==== ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ====
        function initializeSearchPage() {
            populateDateSearch();
            populateMonthSearch();
            document.getElementById('searchResultsTitle').style.display = 'none';
            document.getElementById('pdfButtons').style.display = 'none';
            document.getElementById('searchResultsContainer').innerHTML = '';
        }

        function populateDateSearch() {
            const dateSelect = document.getElementById('dateSearch');
            dateSelect.innerHTML = '<option value="">S√©lectionnez une date</option>';
            
            const today = new Date();
            const threeMonthsLater = new Date(today);
            threeMonthsLater.setMonth(today.getMonth() + 3);
            
            const dates = [];
            const currentDate = new Date(today);
            
            while (currentDate <= threeMonthsLater) {
                const dateStr = formatDateForSearch(currentDate);
                dates.push(dateStr);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            dates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = date;
                dateSelect.appendChild(option);
            });
        }

        function populateMonthSearch() {
            const monthSelect = document.getElementById('monthSearch');
            monthSelect.innerHTML = '<option value="">S√©lectionnez un mois</option>';
            
            const today = new Date();
            const months = [];
            
            for (let i = 0; i < 24; i++) {
                const monthDate = new Date(today);
                monthDate.setMonth(today.getMonth() + i);
                const monthStr = `${(monthDate.getMonth() + 1).toString().padStart(2, '0')}/${monthDate.getFullYear()}`;
                months.push(monthStr);
            }
            
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthSelect.appendChild(option);
            });
        }

        function performSearch() {
            const dateSearch = document.getElementById('dateSearch').value;
            const monthSearch = document.getElementById('monthSearch').value;
            
            if (!dateSearch && !monthSearch) {
                showCustomAlert("RECHERCHE", "Veuillez s√©lectionner une date ou un mois");
                return;
            }
            
            searchResults = [];
            
            if (dateSearch) {
                const [day, month, year] = dateSearch.split('/');
                const searchDateFormatted = `${day}/${month}/20${year}`;
                
                searchResults = products.filter(product => {
                    return product.expiry === searchDateFormatted;
                });
                
                document.getElementById('searchResultsTitle').textContent = `R√âSULTATS POUR: ${dateSearch}`;
            } else if (monthSearch) {
                const [month, year] = monthSearch.split('/');
                searchResults = products.filter(product => {
                    const [d, m, y] = product.expiry.split('/');
                    return m === month && y === year;
                });
                
                document.getElementById('searchResultsTitle').textContent = `R√âSULTATS POUR: ${monthSearch}`;
            }
            
            displaySearchResults();
        }

        function displaySearchResults() {
            const container = document.getElementById('searchResultsContainer');
            const title = document.getElementById('searchResultsTitle');
            const pdfButtons = document.getElementById('pdfButtons');
            
            container.innerHTML = '';
            
            if (searchResults.length === 0) {
                container.innerHTML = '<div class="card"><div class="card-content"><div class="card-name">Aucun produit trouv√©</div></div></div>';
                title.style.display = 'block';
                pdfButtons.style.display = 'none';
                return;
            }
            
            title.style.display = 'block';
            pdfButtons.style.display = 'flex';
            
            searchResults.forEach((p, index) => {
                const remaining = daysLeft(p.expiry);
                const color = daysColor(remaining);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-image-container">
                        ${p.img ? `<img src="${p.img}" alt="">` : ''}
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <span class="days-left" style="background:#3498db">TROUV√â</span>
                        </div>
                        <span class="card-code">${p.code}</span>
                        <div class="card-name">${p.name}</div>
                        <div class="card-details">
                            <span class="card-date">DATE: ${p.expiry}</span>
                            <span class="card-quantity">QUANTIT√â: ${p.quantity}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ==== ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸàÿßŸÑÿ™ÿµÿØŸäÿ± ====
        function importHandler() {
            showCustomAlert("IMPORT", "Fonction d'import - √Ä impl√©menter");
        }

        function downloadXLSXDirect() {
            if (products.length === 0) {
                showCustomAlert("TELECHARGEMENT", "AUCUN PRODUIT √Ä TELECHARGER!");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑÿ™ÿµÿØŸäÿ± (ÿ®ÿØŸàŸÜ ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©)
            let csvContent = "Code,Nom,Date,Quantit√©\n";
            products.forEach(p => {
                csvContent += `${p.code},${p.name},${p.expiry},${p.quantity}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Produits_DLC.csv';
            link.click();
            URL.revokeObjectURL(url);
            
            showSuccessMessage("Fichier t√©l√©charg√© avec succ√®s!");
        }

        function shareXLSXDirect() {
            if (products.length === 0) {
                showCustomAlert("PARTAGE", "AUCUN PRODUIT √Ä PARTAGER!");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©
            downloadXLSXDirect();
            showSuccessMessage("Fichier pr√™t pour le partage!");
        }

        function downloadCasseFraisXLSXDirect() {
            if (casseFraisProducts.length === 0) {
                showCustomAlert("TELECHARGEMENT", "AUCUN PRODUIT √Ä TELECHARGER!");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑÿ™ÿµÿØŸäÿ± (ÿ®ÿØŸàŸÜ ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©)
            let csvContent = "Code,Nom,Date,Quantit√©\n";
            casseFraisProducts.forEach(p => {
                csvContent += `${p.code},${p.name},${p.expiry},${p.quantity}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Casse_Frais.csv';
            link.click();
            URL.revokeObjectURL(url);
            
            showSuccessMessage("Fichier t√©l√©charg√© avec succ√®s!");
        }

        function shareCasseFraisXLSXDirect() {
            if (casseFraisProducts.length === 0) {
                showCustomAlert("PARTAGE", "AUCUN PRODUIT √Ä PARTAGER!");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©
            downloadCasseFraisXLSXDirect();
            showSuccessMessage("Fichier pr√™t pour le partage!");
        }

        function downloadPDF() {
            if (searchResults.length === 0) {
                showCustomAlert("PDF", "Aucun r√©sultat √† exporter");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑÿ™ÿµÿØŸäÿ± PDF
            let content = "RAPPORT DLC\n\n";
            searchResults.forEach((product, index) => {
                content += `Produit ${index + 1}:\n`;
                content += `Code: ${product.code}\n`;
                content += `Nom: ${product.name}\n`;
                content += `Date: ${product.expiry}\n`;
                content += `Quantit√©: ${product.quantity}\n\n`;
            });
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Rapport_DLC.txt';
            link.click();
            URL.revokeObjectURL(url);
            
            showSuccessMessage("Rapport t√©l√©charg√© avec succ√®s!");
        }

        function sharePDF() {
            if (searchResults.length === 0) {
                showCustomAlert("PDF", "Aucun r√©sultat √† exporter");
                return;
            }
            
            // ÿ™ŸÜŸÅŸäÿ∞ ÿ®ÿ≥Ÿäÿ∑ ŸÑŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©
            downloadPDF();
            showSuccessMessage("Rapport pr√™t pour le partage!");
        }

        // ==== ÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ====
        function formatDateInput(input) {
            if (!input) return null;
            
            let str = String(input).trim();
            let parts = str.split('/');
            
            if (parts.length !== 3) return null;
            if (parts[2].length === 2) {
                parts[2] = '20' + parts[2];
            }
            return parts.map(p => p.padStart(2, '0')).join('/');
        }

        function isValidDate(dateStr) {
            const [d, m, y] = dateStr.split('/').map(Number);
            const date = new Date(y, m-1, d);
            return date.getFullYear() === y && date.getMonth() === m-1 && date.getDate() === d;
        }

        function daysLeft(expiry) {
            const [d, m, y] = expiry.split('/').map(Number);
            const expiryDate = new Date(y, m-1, d);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
        }

        function daysColor(days) {
            if (days < 0) return "#e74c3c";
            if (days <= 30) return "#f1c40f";
            if (days <= 60) return "#e67e22";
            if (days <= 90) return "#3498db";
            return "#2ecc71";
        }

        function formatDate() {
            let val = this.value.replace(/[^0-9]/g, '');
            if (val.length > 2 && val.length <= 4) val = val.slice(0, 2) + '/' + val.slice(2);
            else if (val.length > 4) val = val.slice(0, 2) + '/' + val.slice(2, 4) + '/' + val.slice(4, 6);
            this.value = val.slice(0, 8);
        }

        function formatDateForSearch(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear().toString().slice(-2);
            return `${day}/${month}/${year}`;
        }

        // ==== ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä ====
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
            updateStorageInfo();
        }

        function saveCasseFraisProducts() {
            localStorage.setItem('casseFraisProducts', JSON.stringify(casseFraisProducts));
        }

        function loadUserData() {
            const userName = localStorage.getItem('userName');
            const rayon = localStorage.getItem('rayon');
            
            if (userName) {
                document.getElementById('userNameInput').value = userName;
            }
            
            if (rayon) {
                document.getElementById('rayonSelect').value = rayon;
            }
        }

        function saveUserData() {
            const userName = document.getElementById('userNameInput').value;
            const rayon = document.getElementById('rayonSelect').value;
            
            localStorage.setItem('userName', userName);
            localStorage.setItem('rayon', rayon);
        }

        function updateStorageInfo() {
            const storageInfo = document.getElementById('storageInfo');
            const estimatedSize = products.length * 30;
            const maxSize = 50000;
            const percentage = Math.min((estimatedSize / maxSize) * 100, 100);
            const status = percentage < 80 ? '‚úÖ' : percentage < 95 ? '‚ö†Ô∏è' : 'üî¥';
            
            storageInfo.innerHTML = 
                `${status} Stockage: ${products.length} produits (${Math.round(percentage)}% utilis√©) | 
                Capacit√©: 1000+ produits avec photos`;
        }

        // ==== ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ====
        function loadDatabase() {
            // ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
            database = [
                { Code: "1234567890123", Nom: "PRODUIT TEST 1" },
                { Code: "2345678901234", Nom: "PRODUIT TEST 2" },
                { Code: "3456789012345", Nom: "PRODUIT TEST 3" },
                { Code: "4567890123456", Nom: "PRODUIT TEST 4" },
                { Code: "5678901234567", Nom: "PRODUIT TEST 5" }
            ];
        }

        // ==== ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© ====
        function showCustomAlert(title, message, callback = null) {
            const modal = document.getElementById('customConfirmModal');
            const titleElement = document.getElementById('confirmTitle');
            const messageElement = document.getElementById('confirmMessage');
            const cancelBtn = document.getElementById('confirmCancelBtn');
            const okBtn = document.getElementById('confirmOkBtn');

            titleElement.textContent = title;
            messageElement.textContent = message;

            cancelBtn.style.display = 'none';
            okBtn.textContent = 'OK';
            okBtn.className = 'confirm-btn alert-ok';

            modal.style.display = 'flex';

            const handleOk = function() {
                modal.style.display = 'none';
                if (callback) callback();
            };

            okBtn.onclick = handleOk;
        }

        function showCustomConfirm(count, callback, customTitle = "Confirmation de suppression", customMessage = null) {
            const modal = document.getElementById('customConfirmModal');
            const titleElement = document.getElementById('confirmTitle');
            const messageElement = document.getElementById('confirmMessage');
            const cancelBtn = document.getElementById('confirmCancelBtn');
            const okBtn = document.getElementById('confirmOkBtn');

            if (customMessage) {
                messageElement.textContent = customMessage;
            } else {
                messageElement.innerHTML = `Voulez-vous vraiment supprimer <span id="productCountToDelete">${count}</span> produits ?`;
            }
            
            titleElement.textContent = customTitle;
            
            cancelBtn.style.display = 'block';
            okBtn.textContent = 'SUPPRIMER';
            okBtn.className = 'confirm-btn confirm-ok';
            
            modal.style.display = 'flex';

            const handleCancel = function() {
                modal.style.display = 'none';
            };

            const handleOk = function() {
                modal.style.display = 'none';
                if (callback) callback();
            };

            cancelBtn.onclick = handleCancel;
            okBtn.onclick = handleOk;
        }

        function closeConfirmModal() {
            document.getElementById('customConfirmModal').style.display = 'none';
        }

        function confirmAction() {
            document.getElementById('customConfirmModal').style.display = 'none';
        }

        function showSuccessMessage(message) {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        // ==== ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ£ÿπŸÑŸâ ====
        function setupScrollToTop() {
            const scrollToTopMain = document.getElementById('scrollToTopMain');
            const scrollToTopSearch = document.getElementById('scrollToTopSearch');
            const scrollToTopCasseFrais = document.getElementById('scrollToTopCasseFrais');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    if (document.getElementById('mainPage').style.display !== 'none') {
                        scrollToTopMain.style.display = 'block';
                        scrollToTopSearch.style.display = 'none';
                        scrollToTopCasseFrais.style.display = 'none';
                    } else if (document.getElementById('searchPage').style.display !== 'none') {
                        scrollToTopMain.style.display = 'none';
                        scrollToTopSearch.style.display = 'block';
                        scrollToTopCasseFrais.style.display = 'none';
                    } else if (document.getElementById('casseFraisPage').style.display !== 'none') {
                        scrollToTopMain.style.display = 'none';
                        scrollToTopSearch.style.display = 'none';
                        scrollToTopCasseFrais.style.display = 'block';
                    }
                } else {
                    scrollToTopMain.style.display = 'none';
                    scrollToTopSearch.style.display = 'none';
                    scrollToTopCasseFrais.style.display = 'none';
                }
            });

            scrollToTopMain.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            scrollToTopSearch.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            scrollToTopCasseFrais.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
    </script>
</body>
</html>