<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Gestion Produits Simple</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; padding: 20px; background: #f5f7fa; }
h2 { text-align: center; }
input, button { padding:8px; margin:5px 0; }
#cards { margin-top:20px; }
.card { background:#fff; padding:10px; margin-bottom:10px; border-radius:6px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
</style>
</head>
<body>

<h2>Gestion Produits</h2>

<input id="code" placeholder="Code produit">
<input id="name" placeholder="Nom produit" readonly>
<input id="qty" type="number" placeholder="Quantité">
<button id="add">Ajouter</button>
<button id="download">Télécharger CSV</button>

<div id="cards"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<!-- هنا المسار المعدل -->
<script src="JS/exports.js"></script>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];

fetch('produits.csv')
.then(res => res.text())
.then(data => { window.database = Papa.parse(data, {header:true}).data; });

document.getElementById("code").addEventListener("input", function(){
    const code = this.value.trim().toLowerCase();
    const p = (window.database||[]).find(item => (item.Code||"").toLowerCase()===code);
    document.getElementById("name").value = p ? p.Nom : "";
});

document.getElementById("add").addEventListener("click", ()=>{
    const code = document.getElementById("code").value.trim();
    const name = document.getElementById("name").value;
    const qty = document.getElementById("qty").value;
    if(!code || !name || !qty){ alert("Remplissez tous les champs"); return; }
    products.push({code,name,qty});
    localStorage.setItem("products", JSON.stringify(products));
    render();
});

function render(){
    const container = document.getElementById("cards");
    container.innerHTML="";
    products.forEach((p,i)=>{
        const div = document.createElement("div");
        div.className="card";
        div.innerHTML=`${p.code} - ${p.name} - Q: ${p.qty} <button onclick="del(${i})">X</button>`;
        container.appendChild(div);
    });
}

function del(i){ products.splice(i,1); localStorage.setItem("products", JSON.stringify(products)); render(); }

document.getElementById("download").addEventListener("click", ()=>{
    let csv="Code,Nom,Quantité\n";
    products.forEach(p=>{ csv+=`${p.code},${p.name},${p.qty}\n`; });
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download="produits.csv"; a.click();
});
render();
</script>

</body>
</html>